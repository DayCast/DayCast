// prisma/schema.prisma

model User{
    id                  String              @id @default(cuid())
    email               String              @unique
    name                String
    createdAt           DateTime            @default(now())
    updatedAt           DateTime            @updatedAt

    // リレーション
    todos               Todo[]
    calendarEvents      CalendarEvent[]
    settings            UserSettings?

    //Oauth関連
    accounts            Account[]
    sessions            Session[]
}


model CalendarEvent{
    id                  String              @id @default(cuid())
    userId              String
    title               String
    description         String?             @db.Text
    location            String?
    startTime           DateTime
    endTime             DateTime

    // AIの調査結果を格納するフィールド
    weatherInfo         Json?                                                       //exp){temp:20,condition:sunny}
    requiredEventId     String?                                                     //AIが見つけた必要物リスト
    googleEventId       String?                                                     //googleカレンダーと同起用ID

    @@index([userId, startTime])
}


model Todo{
    id                  String              @id @default(cuid())
    userId              String
    title               String
description         String?                 @db.Text

    //優先順位・スコアリング関係
    priority            String              @default("medium")                      //high, medium, low
    aiScore             Int                 @default(0)                             //0-100
    aiReason            String?             @db.Text

    status              String?             @default("pending")                     //pending or completed
    dueDate             DateTime?

    //カレンダーの予定に紐づくTodo(削除予定)
    calendarEventId     String?
    calendarEventId     CalendarEvent?      @relation(fields : [calendarEventId], references: [id])

    user                User                @relation(fields: [userId],references: [id],onDalete: Cascade)

    @@index([userId, aiScore])
}

// Auth.js (NextAuth) に必要なモデル
model Account {
  id                 String  @id @default(cuid())
  userId             String
  type               String
  provider           String
  providerAccountId  String
  refresh_token      String?  @db.Text
  access_token       String?  @db.Text // これがAIがカレンダーを叩く「鍵」になる
  expires_at         Int?
  token_type         String?
  scope              String?
  id_token           String?  @db.Text
  session_state      String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}